---
layout: article
title: Week In Review 12-20-2013
date: '2013-12-21T15:36:00.002-08:00'
author: aml
tags: 
modified_time: '2013-12-21T15:36:27.070-08:00'
blogger_id: tag:blogger.com,1999:blog-1730093662423317857.post-5484830930392237729
blogger_orig_url: https://immutablearlandis.blogspot.com/2013/12/week-in-review-12-20-2013.html
---

Phil and I worked kanban-style on the dojo-dashboard this week. It was a refreshing change of pace and we managed to get a lot done.<br /><br />I worked mostly on refactoring one particularly nasty namespace; it was a big OCP violation. The namespace basically worked like this: a user enters some text describing the "widget" they want created on the screen, the namespace takes a look at that text and cross-references it with a list of possible values that it has. The problem with this approach is that if a programmer wanted to add a new kind of widget s/he would've needed to add it to the hash. This was pretty much the textbook example of when a refactor to polymorphism is needed.<br /><br />After finishing a lot of other work in the namespace, I was finally able to turn this:<br /><br />"<br />(ns add-widget)<br /><br />(defn widget-fns<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; "text_for_widget_one" fn_to_create_widget_one<br />&nbsp; &nbsp; "text_for_widget_two" fn_to_create_widget_two<br />&nbsp; &nbsp; })<br /><br />&nbsp; (defn add-widget [submitted-text]<br />&nbsp; &nbsp; (let [desired-widget (interpret submitted-text)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fn-for-desired-widget (widget-fns submitted-text)]<br />&nbsp; &nbsp; &nbsp; (fn-for-desired-widget)))"<br /><br />into this:<br /><br />"<br />(ns add-widget)<br /><br />(defmulti widget-fn-for (fn [desired-widget] desired-widget))<br /><br />(defn add-widget [submitted-text]<br />&nbsp; (let [desired-widget (interpret submitted-text)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fn-for-desired-widget (widget-fn-for desired-widget)]<br />&nbsp; &nbsp; (fn-for-desired-widget)))<br />--------------------------------------------------------<br />(ns widget-one<br />&nbsp; (:require [add-widget :refer [widget-fn-for]]))<br /><br />(defmethod widget-fn-for "widget-one" [_] :create-widget-one)<br />---------------------------------------------------------<br />(ns widget-two<br />&nbsp; (:require [add-widget :refer [widget-fn-for]]))<br /><br />&nbsp; (defmethod widget-fn-for "widget-two" [_] :create-widget-two)<br />"<br /><br />I found this approach to be much cleaner, since new widgets can be added without ever touching the add-widget namespace. This puts the knowledge about which widgets exist and what their names are in their respective namespaces.
