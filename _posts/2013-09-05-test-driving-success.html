---
layout: article
title: Test-Driving Success
date: '2013-09-05T20:06:00.001-07:00'
author: aml
tags:
- apprenticeship
modified_time: '2013-09-05T20:06:14.250-07:00'
blogger_id: tag:blogger.com,1999:blog-1730093662423317857.post-3960356789736734858
blogger_orig_url: https://immutablearlandis.blogspot.com/2013/09/test-driving-success.html
---

I had a small victory today in my TDD cycle. I test-drove some code, waited until I had refactored what I wrote into a method and then decided it was time to extract it into a class. Finally, I saw another refactor that I wanted to happen and pushed my code towards it. The whole experience was pretty rewarding.<br /><br />This was what I started with:<br /><br /><br /><pre class="brush:ruby" name="code">post '/move' do<br />    human_move = params[:player_move]<br />    state_of_human_vs_ai_game = return_service_response(human_move)<br />    ai_move = state_of_human_vs_ai_game["ai_move"]<br />    winner_of_human_vs_ai_game = state_of_human_vs_ai_game["winner_after_ai_move"]<br />    response.set_cookie(human_move,"x")<br />    if humans_only(cookies)<br />      response.set_cookie(4,"o")<br />    else<br />      response.set_cookie(ai_move,"o")<br />    end<br />    response.set_cookie("human_vs_ai_winner",winner_of_human_vs_ai_game)    <br />    redirect '/'<br />  end<br /></pre><br />That "humans_only" function just lets us know whether or not there's an AI player involved. That hardcoded 4? I used that to make another test pass and realized I needed to refactor before I kept going. Anyways, I saw that I had this notion of performing one action if both players were human and another action if an ai was involved, yet both the ai and a human player share the action of making a move. It seems like we have some sort of abstraction here. Here was my next step:  <br /><br /><pre class="brush:ruby" name="code">post '/move' do<br />    human_move = params[:player_move]<br />    state_of_human_vs_ai_game = return_service_response(human_move)<br />    ai_move = state_of_human_vs_ai_game["ai_move"]<br />    winner_of_human_vs_ai_game = state_of_human_vs_ai_game["winner_after_ai_move"]<br />    response.set_cookie(human_move,"x")<br />    move, token = NextPlayer.move(cookies,ai_move)<br />    response.set_cookie(move,token)<br />    response.set_cookie("human_vs_ai_winner",winner_of_human_vs_ai_game)    <br />    redirect '/'<br />  end<br /></pre><pre class="brush:ruby" name="code"><br /></pre><pre class="brush:ruby" name="code"></pre>Here, I'm passing the ai move that I got from the Tic Tac Toe side into this "NextPlayer" class I created. Notice that the conditional from before is gone. That's because I pushed it down into the NextPlayer class. The idea here is that I give it a reference to the game information and an ai move, and it figures out who the next player is and gives me a token and move back. This is still pretty ugly though. What's the point of the class if it can't give me an ai move directly? Why do I have to pass one in? The code is in a hacked state right now. This is really an intermediate step that I needed to make in order to stay green.<br /><br /><pre class="brush:ruby" name="code">    human_move = params[:player_move]<br />    move, token = NextPlayer.move(cookies,human_move)</pre><pre class="brush:ruby" name="code"><pre class="brush:ruby" name="code">    winner = return_service_response(human_move)["winner_on_board"]</pre><pre class="brush:ruby" name="code">    response.set_cookie(human_move,"x")</pre>response.set_cookie(move,token)     response.set_cookie("winner", winner)         redirect '/'   end </pre><pre class="brush:ruby" name="code"><br /></pre><pre class="brush:ruby" name="code"></pre>So there's actually quite a bit that happened in the last step. In the interest of brevity, I'll sum it up. <br />I was only hitting the service once before; getting all the information I needed. Now, I hit it twice. Once through the NextPlayer class that will actually give me an ai move now, and once after that so that I can figure out relevant information.<br /><br />Also, I found a bug as I wrote this. When I query the Tic Tac Toe service for a winner, I forgot to update the game state with the new ai move. This was all happening in one step before, but I've made quite a few adjustments. Fixing that will be first thing on the agenda tomorrow.
