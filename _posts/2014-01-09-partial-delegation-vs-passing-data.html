---
layout: post
title: Partial Delegation Vs Passing Data
date: '2014-01-09T19:33:00.002-08:00'
author: aml
tags: 
modified_time: '2014-01-09T19:33:52.001-08:00'
blogger_id: tag:blogger.com,1999:blog-1730093662423317857.post-8995761349453405788
blogger_orig_url: https://immutablearlandis.blogspot.com/2014/01/partial-delegation-vs-passing-data.html
---

There's an interesting pattern in the codebase I'm working in where, in complex views, we retrieve the data content of one view and pass it on.<br /><br />The controller ends up looking something like this:<br /><br />""<br />(def data-to-render<br />&nbsp; {:form (render "form_for_my_view.html")<br />&nbsp; &nbsp; :modal (render "modal_for_my_view.html")})<br /><br />(render<br />&nbsp; "my_view.html"<br />&nbsp; &nbsp;data-to-render)<br />""<br /><br />In this case, the form view and modal view get evaluated and passed around as data to the parent view. The parent view looks for the data inside the hash; we use mustache.<br /><br />""<br />&lt;html&gt;<br />&nbsp; {{ "{{" }}&amp;form}}<br />&nbsp; {{ "{{" }}&amp;modal}}<br />&lt;/html&gt;<br />""<br /><br />I don't think this is a terrible pattern, but it's kind of strange when the typical convention is to use partials. With that in mind, Wai Lee and I spent a considerable amount of time refactoring to a partial implementation. We wound up with something like this:<br /><br />""<br />(def partials<br />&nbsp; {:form "form_view.html"<br />&nbsp; &nbsp; :modal "modal_view.html"})<br /><br />(def data-to-render<br />&nbsp; {:data [:some :data]})<br /><br />(render<br />&nbsp; "my_view.html"<br />&nbsp; data-to-render<br />&nbsp; partials)<br /><br />""<br /><br />Now, the view talks about the partial rather than the raw data. The controller packages up the routes to the partials with their corresponding names and the topmost view just delegates to the next view that it needs to show.<br /><br />Our solution seems "cleaner" in a sense, but it's also more indirect. Before, if I wanted to know how a particular view hierarchy worked, all the knowledge was in the same place.<br /><br />""<br />(defn render-cities<br />&nbsp; (render<br />&nbsp; &nbsp; "Chicago"<br />&nbsp; &nbsp; {}<br />&nbsp; &nbsp; {:traffic<br />&nbsp; &nbsp; &nbsp; &nbsp;(render "traffic_view.html"<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(render "weather_view.html"))}))<br />""<br /><br />I can look at this and tell immediately that the "Chicago" view has a dependency on the "traffic_view" and the "traffic_view" has a dependency on the "weather_view", whereas if I had some code like this:<br /><br />""<br />(def partials<br />&nbsp; {:weather "weather_view.html"<br />&nbsp; &nbsp; :traffic "traffic_view.html"})<br /><br />(render<br />&nbsp; "Chicago"<br />&nbsp; {}<br />&nbsp; &nbsp;partials) <br />""<br /><br />it's obvious that "Chicago" is the topmost view, but I can't tell how the "weather_view" and "traffic_view" fit in. Maybe "Chicago" needs both of them, or maybe the "traffic_view" uses the "weather_view" to illustrate how poor road conditions are; the only way for me to find out is to look at the views themselves, which kind of sucks.