---
layout: article
title: Sinatra + Cucumber Environment Management
date: '2013-09-17T19:07:00.001-07:00'
author: aml
tags: 
modified_time: '2013-09-17T19:19:00.410-07:00'
blogger_id: tag:blogger.com,1999:blog-1730093662423317857.post-43082823255804027
blogger_orig_url: https://immutablearlandis.blogspot.com/2013/09/sinatra-cucumber-environment-management.html
---

I came up against an interesting problem today that I'm sure many seasoned developers already know how to solve, but the solution may be less obvious if you're new to the world of professional software development.<br /><br /><b>Scenario</b><br /><b><br /></b>Like a world-class professional you have tons of tests for your application, touching the various levels of the testing pyramid. Some of the higher-level tests write to your application's storage system (files, database, etc.). You want to ensure that what you expect to get written in that storage system is actually being written. But, you don't want to pollute your storage with test information. What do you do?<br /><br /><b>Solution</b><br /><b><br /></b>The solution for me was a bit of knowledge about common development practice, and some knowledge of Cucumber.<br /><br />The conceptual solution is to create different "environments" that your application can run in. The nuances involved in my solution assume use of the Sinatra web framework and the Cucumber acceptance test suite.<br /><br /><b>Sinatra + Cucumber Environment Management</b><br /><br />First, I created a "config.yml" file to manage my different "environments". Typically, these are split into categories like: production, development, staging, and test. Next up was to figure out how to reference these configurations inside of my application. Turns out it was as simple as adding a couple of lines to the main app &nbsp;file. <br /><br /><pre class="brush:ruby" name="code">class TTTDuet &lt; Sinatra::Base<br />  register Sinatra::ConfigFile<br />  config_file 'config.yml'<br />end<br /></pre><br />I should note here that the settings default to the "development" environment. You can change it directly in the main app file. <br /><br /><pre class="brush:ruby" name="code">set :environment, :production<br /></pre><br />After setting that up, you can reference any of the settings in that config file by prepending "settings" to it. For instance, "settings.database_name" would give me access to the database name listed in the "config.yml" file inside of the "development" environment. <br /><br />The final step consisted of changing a line in my Cucumber environment file at "features/support/env.rb". Inside of that file, I changed the environment variable to use my test environment like so (This snippet has to go at the top of the file):<br /><br /><pre class="brush:ruby" name="code">ENV['RACK_ENV'] = 'test'<br /></pre>
