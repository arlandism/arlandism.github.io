---
layout: post
title: Fighting Polymorphic Prefactoring
date: '2013-10-09T07:20:00.003-07:00'
author: aml
tags: 
modified_time: '2013-10-09T07:20:40.351-07:00'
blogger_id: tag:blogger.com,1999:blog-1730093662423317857.post-5661043663088992044
blogger_orig_url: https://immutablearlandis.blogspot.com/2013/10/fighting-polymorphic-prefactoring.html
---

Often, I'll find myself implementing some potentially smelly code and have to fight hard against the urge to do a premature refactor.<br /><br /><b>Example</b><br /><b><br /></b>I have this request handling code:<br /><br /><br /><pre class="brush:java" name="code">        String response;<br />        String head = "HTTP/1.0 200 OK";<br />        String contentType = "Content-type: text/html";<br />        String body;<br /><br />        if (request.headers().startsWith("GET /form")) {<br />            body = formBody();<br />        } else if (request.headers().startsWith("POST ")) {<br />            body = formParams();<br />        } else{<br />            body = pongBody();<br />        }<br /><br />        response = head + "\n" + contentType + "\n\r\n" + body;<br />        return response;<br /></pre><br />There's a conditional that will grow with each response. <a href="http://blog.8thlight.com/wai-lee-chin-feman/2013/08/11/anti-anti-if.html" target="_blank">This isn't inherently bad</a> and could be warranted if there were no plans for further kinds of responses. At this point in the code, I didn't feel it necessary to refactor to a polymorphic approach because of the complexity involved. Then, I needed to add another kind of response.<br /><br /><br /><br /><pre class="brush:java" name="code">        String response;<br />        String head = "HTTP/1.0 200 OK";<br />        String contentType = "Content-type: text/html";<br />        String body;<br /><br />        if (request.headers().startsWith("GET /form")) {<br />            body = formBody();<br />        } else if (request.headers().startsWith("POST ")) {<br />            body = formParams();<br />        } else if (request.headers().startsWith("GET /ping?sleep")){<br />            request.sleep();<br />            body = pongBody();<br />        } else{<br />            body = pongBody();<br />        }<br /><br />        response = head + "\n" + contentType + "\n\r\n" + body;<br />        return response;<br /></pre><br />At this point I feel the code has grown enough to warrant some kind of polymorphic approach.<br /><br /><b>Other Thoughts</b><br /><b><br /></b>Perhaps a more interesting issue here is that this "ResponseBuilder" class is building responses based on data that lives inside of the "Request" class - this could be a sign that the "Request" class should have its own "response" method.