---
layout: post
title: Hidden Asssertions
date: '2014-02-02T18:19:00.003-08:00'
author: aml
tags: 
modified_time: '2014-02-02T18:19:49.302-08:00'
blogger_id: tag:blogger.com,1999:blog-1730093662423317857.post-3782205557777952558
blogger_orig_url: https://immutablearlandis.blogspot.com/2014/02/hidden-asssertions.html
---

Today, I caught myself writing a test that looked similar to this:<br /><br /><br /><pre class="brush:ruby" name="code">it "inserts whitespace when conjoining strings" do<br />  thing_one = ["Hello"]<br />  thing_two = ["World!"]<br />  Formatter.conjoin(thing_one, thing_two).count.should == 1<br />  Formatter.conjoin(thing_one, thing_two).should == ["Hello World!"]<br />end<br /></pre><br /><br />I immediately disliked it because of the double assertion. There's an assertion against the number of items in the return value and there's a separate assertion against the format of the return value. I think that this example should definitely be split between two tests.<br /><br /><br /><pre class="brush:ruby" name="code">it "conjoins items" do<br />  thing_one = ["Hello"]<br />  thing_two = ["World!"]<br />  Formatter.conjoin(thing_one, thing_two).count.should == 1<br />end<br /><br />it "inserts whitespace when conjoining strings" do<br />  thing_one = ["Hello"]<br />  thing_two = ["World!"]<br />  Formatter.conjoin(thing_one, thing_two).should == ["Hello World"]<br />end<br /></pre><br />I like the second approach better because it's extremely explicit. I think the first approach is very tempting because there's so much less code to read, which is usually a good thing but not necessarily in the context of a test. The first approach is a good example of an SRP violation in test form, since it's making assertions against two separate properties of the returned value. This makes the test harder to mentally parse and understand. The second approach introduces a lot more boilerplate but is very explicit about what's happening; it could also be refactored to eliminate the boilerplate.<br /><br />I'm wary of tests with multiple assertions in them. One possible exception is the case where both assertions are needed to accurately demonstrate properties of the return value. One example of this could be:<br /><br /><br /><pre class="brush:ruby" name="code">it "adds to the stack" do<br />  stack = Stack.new<br />  stack.push("Hello")<br />  stack.count.should == 1<br />  stack.pop.should == "Hello"<br />end<br /></pre><br />I'm a bit unsure about that example as well, but I see it as being less dangerous than the previous examples. Here, at least two separate properties aren't being checked; the double-assertion seems redundant though. My inability to contrive a better example suggests to me that it's probably always safer to not use this technique.